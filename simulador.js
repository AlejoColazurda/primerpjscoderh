// Constantes del sistema
const DESCUENTO_3_JUEGOS = 0.1 // 10% descuento por 3 juegos
const DESCUENTO_5_JUEGOS = 0.15 // 15% descuento por 5 juegos
const DESCUENTO_VIP = 0.2 // 20% descuento VIP
const IVA = 0.21 // 21% IVA

// Variables globales
let carritoCompras = []
const totalCompra = 0
let clienteVIP = false

// Array con el cat√°logo de videojuegos
const catalogoJuegos = [
  { id: 1, nombre: "The Legend of Zelda: Breath of the Wild", precio: 59.99, categoria: "Aventura", stock: 15 },
  { id: 2, nombre: "Super Mario Odyssey", precio: 49.99, categoria: "Plataformas", stock: 20 },
  { id: 3, nombre: "Call of Duty: Modern Warfare", precio: 69.99, categoria: "Acci√≥n", stock: 12 },
  { id: 4, nombre: "FIFA 24", precio: 59.99, categoria: "Deportes", stock: 25 },
  { id: 5, nombre: "Minecraft", precio: 29.99, categoria: "Sandbox", stock: 30 },
  { id: 6, nombre: "Grand Theft Auto V", precio: 39.99, categoria: "Acci√≥n", stock: 18 },
  { id: 7, nombre: "Fortnite Battle Pass", precio: 9.99, categoria: "Battle Royale", stock: 100 },
  { id: 8, nombre: "Cyberpunk 2077", precio: 49.99, categoria: "RPG", stock: 8 },
]

// ==================== FUNCIONES PRINCIPALES ====================

/**
 * Funci√≥n principal que inicia el simulador
 */
function iniciarSimulador() {
  console.clear()
  console.log("üéÆ ¬°BIENVENIDO A LA TIENDA DE VIDEOJUEGOS, CHE! üéÆ")
  console.log("=".repeat(50))

  // Solicitar datos del cliente
  const datosCliente = solicitarDatosCliente()

  if (datosCliente) {
    mostrarBienvenida(datosCliente.nombre, datosCliente.esVIP)
    mostrarMenu()
  } else {
    alert("‚ùå Simulador cancelado. ¬°Vuelve pronto!")
  }
}

/**
 * Funci√≥n para solicitar y validar datos del cliente
 * @returns {Object|null} Objeto con datos del cliente o null si se cancela
 */
function solicitarDatosCliente() {
  console.log("üìã Solicitando datos del cliente...")

  // Solicitar nombre del cliente
  let nombreCliente = prompt("üë§ Decime tu nombre para empezar, dale:")

  if (!nombreCliente) {
    return null // Usuario cancel√≥
  }

  // Validar que el nombre no est√© vac√≠o
  while (nombreCliente.trim() === "") {
    nombreCliente = prompt("‚ö†Ô∏è Eh, no pod√©s dejar el nombre vac√≠o.\nDecime tu nombre, dale:")
    if (!nombreCliente) return null
  }

  // Preguntar si es cliente VIP
  const esVIP = confirm(`¬°Hola ${nombreCliente}! üåü\n¬øSos cliente VIP de nuestro local?`)
  clienteVIP = esVIP

  console.log(`‚úÖ Cliente registrado: ${nombreCliente} ${esVIP ? "(VIP)" : "(Regular)"}`)

  return {
    nombre: nombreCliente,
    esVIP: esVIP,
  }
}

/**
 * Funci√≥n para mostrar mensaje de bienvenida personalizado
 * @param {string} nombre - Nombre del cliente
 * @param {boolean} esVIP - Si el cliente es VIP
 */
function mostrarBienvenida(nombre, esVIP) {
  let mensajeBienvenida = `üéâ ¬°Bienvenido/a ${nombre}!\n\n`

  if (esVIP) {
    mensajeBienvenida += `‚≠ê Como cliente VIP ten√©s un descuento especial del ${DESCUENTO_VIP * 100}% en toda tu compra, b√°rbaro.\n\n`
  } else {
    mensajeBienvenida += `üí° Che, comprando 3 o m√°s juegos te llev√°s descuentos especiales:\n`
    mensajeBienvenida += `   ‚Ä¢ 3-4 juegos: ${DESCUENTO_3_JUEGOS * 100}% de descuento\n`
    mensajeBienvenida += `   ‚Ä¢ 5+ juegos: ${DESCUENTO_5_JUEGOS * 100}% de descuento\n\n`
  }

  mensajeBienvenida += `üõí ¬°Dale que empezamos con tu compra!`

  alert(mensajeBienvenida)
  console.log("üéØ Cliente configurado correctamente")
}

/**
 * Funci√≥n para mostrar el men√∫ principal y gestionar opciones
 */
function mostrarMenu() {
  let continuar = true

  while (continuar) {
    console.log("\n" + "=".repeat(40))
    console.log("üì± MEN√ö PRINCIPAL")
    console.log("=".repeat(40))

    const opcion = prompt(
      "üéÆ TIENDA DE VIDEOJUEGOS - MEN√ö PRINCIPAL\n\n" +
        "Eleg√≠ una opci√≥n:\n\n" +
        "1Ô∏è‚É£ Ver cat√°logo completo\n" +
        "2Ô∏è‚É£ Buscar juego por categor√≠a\n" +
        "3Ô∏è‚É£ Agregar juego al carrito\n" +
        "4Ô∏è‚É£ Ver carrito de compras\n" +
        "5Ô∏è‚É£ Procesar compra\n" +
        "6Ô∏è‚É£ Salir\n\n" +
        "Metele el n√∫mero de tu opci√≥n:",
    )

    if (!opcion) {
      continuar = false
      continue
    }

    // Procesar opci√≥n seleccionada
    switch (opcion) {
      case "1":
        mostrarCatalogo()
        break
      case "2":
        buscarPorCategoria()
        break
      case "3":
        agregarJuegoAlCarrito()
        break
      case "4":
        mostrarCarrito()
        break
      case "5":
        procesarCompra()
        break
      case "6":
        continuar = confirmarSalida()
        break
      default:
        alert("‚ùå Esa opci√≥n no va, che. Eleg√≠ un n√∫mero del 1 al 6.")
        console.log("‚ö†Ô∏è Opci√≥n inv√°lida seleccionada:", opcion)
    }
  }
}

/**
 * Funci√≥n para mostrar el cat√°logo completo de juegos
 */
function mostrarCatalogo() {
  console.log("\nüéÆ CAT√ÅLOGO COMPLETO DE VIDEOJUEGOS")
  console.log("=".repeat(60))

  let catalogoTexto = "üéÆ CAT√ÅLOGO DE VIDEOJUEGOS\n\n"

  // Usar ciclo for para recorrer el cat√°logo
  for (let i = 0; i < catalogoJuegos.length; i++) {
    const juego = catalogoJuegos[i]

    console.log(`${juego.id}. ${juego.nombre}`)
    console.log(`   üí∞ Precio: $${juego.precio}`)
    console.log(`   üè∑Ô∏è Categor√≠a: ${juego.categoria}`)
    console.log(`   üì¶ Stock: ${juego.stock} unidades`)
    console.log("-".repeat(40))

    catalogoTexto += `${juego.id}. ${juego.nombre}\n`
    catalogoTexto += `   üí∞ $${juego.precio} | üè∑Ô∏è ${juego.categoria} | üì¶ Stock: ${juego.stock}\n\n`
  }

  alert(catalogoTexto + "‚ú® ¬°Eleg√≠ tus juegos favoritos!")
}

/**
 * Funci√≥n para buscar juegos por categor√≠a
 */
function buscarPorCategoria() {
  console.log("\nüîç B√öSQUEDA POR CATEGOR√çA")

  // Obtener categor√≠as √∫nicas
  const categorias = [...new Set(catalogoJuegos.map((juego) => juego.categoria))]

  let mensajeCategorias = "üîç BUSCAR POR CATEGOR√çA\n\nCategor√≠as que tenemos:\n\n"

  // Mostrar categor√≠as disponibles
  for (let i = 0; i < categorias.length; i++) {
    mensajeCategorias += `${i + 1}. ${categorias[i]}\n`
    console.log(`${i + 1}. ${categorias[i]}`)
  }

  const seleccion = prompt(mensajeCategorias + "\nMetele el n√∫mero de la categor√≠a:")

  if (!seleccion || seleccion < 1 || seleccion > categorias.length) {
    alert("‚ùå Esa selecci√≥n no va, che.")
    return
  }

  const categoriaSeleccionada = categorias[seleccion - 1]
  const juegosFiltrados = catalogoJuegos.filter((juego) => juego.categoria === categoriaSeleccionada)

  console.log(`\nüéØ Juegos de la categor√≠a: ${categoriaSeleccionada}`)
  console.log("=".repeat(50))

  let resultados = `üéØ JUEGOS DE ${categoriaSeleccionada.toUpperCase()}\n\n`

  // Mostrar juegos filtrados
  for (let i = 0; i < juegosFiltrados.length; i++) {
    const juego = juegosFiltrados[i]
    console.log(`${juego.id}. ${juego.nombre} - $${juego.precio}`)
    resultados += `${juego.id}. ${juego.nombre} - $${juego.precio}\n`
  }

  alert(resultados)
}

/**
 * Funci√≥n para agregar un juego al carrito
 */
function agregarJuegoAlCarrito() {
  console.log("\nüõí AGREGAR JUEGO AL CARRITO")

  // Mostrar cat√°logo resumido para facilitar la selecci√≥n
  let catalogoResumido = "üéÆ JUEGOS DISPONIBLES:\n\n"

  for (let i = 0; i < catalogoJuegos.length; i++) {
    const juego = catalogoJuegos[i]
    if (juego.stock > 0) {
      catalogoResumido += `${juego.id}. ${juego.nombre} - $${juego.precio} (Stock: ${juego.stock})\n`
    }
  }

  catalogoResumido += "\n¬øCu√°l quer√©s agregar al carrito?"

  const idJuego = prompt(catalogoResumido + "\n\nDecime el ID del juego:")

  if (!idJuego) return

  // Buscar el juego por ID
  const juegoEncontrado = catalogoJuegos.find((juego) => juego.id == idJuego)

  if (!juegoEncontrado) {
    alert("‚ùå Ese juego no lo encontr√©. Fijate bien el ID.")
    console.log("‚ö†Ô∏è ID de juego no v√°lido:", idJuego)
    return
  }

  // Verificar stock
  if (juegoEncontrado.stock <= 0) {
    alert(`‚ùå Una l√°stima, ${juegoEncontrado.nombre} est√° agotado.`)
    console.log("üì¶ Juego sin stock:", juegoEncontrado.nombre)
    return
  }

  // Preguntar cantidad
  let cantidad = prompt(
    `üî¢ ¬øCu√°ntas copias de "${juegoEncontrado.nombre}" quer√©s llevarte?\n\nüì¶ Stock que tenemos: ${juegoEncontrado.stock}\nüí∞ Precio por unidad: $${juegoEncontrado.precio}`,
  )

  if (!cantidad) return

  cantidad = Number.parseInt(cantidad)

  if (isNaN(cantidad) || cantidad <= 0) {
    alert("‚ùå Esa cantidad no va, che. Tiene que ser un n√∫mero mayor a 0.")
    return
  }

  if (cantidad > juegoEncontrado.stock) {
    alert(`‚ùå No tenemos tanto stock, loco. Solo nos quedan ${juegoEncontrado.stock} unidades.`)
    return
  }

  // Verificar si ya est√° en el carrito
  const juegoEnCarrito = carritoCompras.find((item) => item.id === juegoEncontrado.id)

  if (juegoEnCarrito) {
    // Si ya est√°, agregar a la cantidad existente
    const nuevaCantidad = juegoEnCarrito.cantidad + cantidad
    if (nuevaCantidad > juegoEncontrado.stock + juegoEnCarrito.cantidad) {
      alert(
        `‚ùå No pod√©s agregar ${cantidad} m√°s. Ya ten√©s ${juegoEnCarrito.cantidad} en el carrito y solo tenemos ${juegoEncontrado.stock + juegoEnCarrito.cantidad} disponibles.`,
      )
      return
    }
    juegoEnCarrito.cantidad = nuevaCantidad
    juegoEnCarrito.subtotal = juegoEnCarrito.precio * juegoEnCarrito.cantidad
  } else {
    // Agregar nuevo juego al carrito
    carritoCompras.push({
      id: juegoEncontrado.id,
      nombre: juegoEncontrado.nombre,
      precio: juegoEncontrado.precio,
      categoria: juegoEncontrado.categoria,
      cantidad: cantidad,
      subtotal: juegoEncontrado.precio * cantidad,
    })
  }

  // Reducir stock
  juegoEncontrado.stock -= cantidad

  console.log(`‚úÖ ${cantidad}x ${juegoEncontrado.nombre} agregado al carrito`)

  // Mensaje personalizado seg√∫n el juego
  let mensajePersonalizado = `‚úÖ ¬°B√°rbaro! ${cantidad}x ${juegoEncontrado.nombre} agregado al carrito!\nüí∞ Subtotal: $${(juegoEncontrado.precio * cantidad).toFixed(2)}\n\n`

  // Agregar comentarios especiales seg√∫n el juego
  if (juegoEncontrado.nombre.includes("FIFA") || juegoEncontrado.nombre.includes("Call of Duty")) {
    mensajePersonalizado += "üî• ¬°Te est√°s llevando uno de los m√°s buscados!\n"
  } else if (juegoEncontrado.nombre.includes("Zelda") || juegoEncontrado.nombre.includes("Mario")) {
    mensajePersonalizado += "üåü ¬°Excelente elecci√≥n! Un cl√°sico que nunca falla.\n"
  } else if (juegoEncontrado.nombre.includes("Minecraft")) {
    mensajePersonalizado += "‚õèÔ∏è ¬°Perfecto para crear mundos incre√≠bles!\n"
  } else if (juegoEncontrado.nombre.includes("Cyberpunk")) {
    mensajePersonalizado += "ü§ñ ¬°Te va a volar la cabeza este juego!\n"
  }

  // Calcular total de juegos en carrito
  let totalJuegos = 0
  for (let i = 0; i < carritoCompras.length; i++) {
    totalJuegos += carritoCompras[i].cantidad
  }

  // Sugerencia de finalizar compra si tiene varios juegos
  if (totalJuegos >= 3) {
    mensajePersonalizado += `\nüéØ Ya ten√©s ${totalJuegos} juegos en el carrito.\n¬øQuer√©s que finalicemos tu compra para asegur√°rtelos?`

    const finalizarAhora = confirm(mensajePersonalizado)

    if (finalizarAhora) {
      procesarCompra()
      return
    }
  } else {
    alert(mensajePersonalizado)
  }
}

/**
 * Funci√≥n para mostrar el contenido del carrito
 */
function mostrarCarrito() {
  console.log("\nüõí CARRITO DE COMPRAS")
  console.log("=".repeat(50))

  if (carritoCompras.length === 0) {
    alert("üõí Tu carrito est√° vac√≠o, che.\n¬°Agreg√° algunos juegos copados!")
    console.log("üì≠ Carrito vac√≠o")
    return
  }

  let carritoTexto = "üõí TU CARRITO DE COMPRAS\n\n"
  let subtotal = 0
  let totalJuegos = 0

  // Mostrar cada juego en el carrito
  for (let i = 0; i < carritoCompras.length; i++) {
    const juego = carritoCompras[i]
    console.log(`${i + 1}. ${juego.nombre} x${juego.cantidad} - $${juego.subtotal.toFixed(2)}`)
    carritoTexto += `${i + 1}. ${juego.nombre}\n   Cantidad: ${juego.cantidad} x $${juego.precio} = $${juego.subtotal.toFixed(2)}\n\n`
    subtotal += juego.subtotal
    totalJuegos += juego.cantidad
  }

  // Calcular descuentos
  const descuento = calcularDescuento(totalJuegos)
  const montoDescuento = subtotal * descuento
  const totalConDescuento = subtotal - montoDescuento
  const impuestos = totalConDescuento * IVA
  const totalFinal = totalConDescuento + impuestos

  carritoTexto += `üí∞ RESUMEN:\n`
  carritoTexto += `Subtotal (${totalJuegos} juegos): $${subtotal.toFixed(2)}\n`

  if (descuento > 0) {
    carritoTexto += `Descuento (${(descuento * 100).toFixed(0)}%): -$${montoDescuento.toFixed(2)}\n`
  }

  carritoTexto += `IVA (${(IVA * 100).toFixed(0)}%): +$${impuestos.toFixed(2)}\n`
  carritoTexto += `TOTAL: $${totalFinal.toFixed(2)}`

  console.log(`\nüí∞ Subtotal: $${subtotal.toFixed(2)}`)
  console.log(`üéÅ Descuento: $${montoDescuento.toFixed(2)}`)
  console.log(`üí∏ Total: $${totalFinal.toFixed(2)}`)

  alert(carritoTexto)
}

/**
 * Funci√≥n para calcular el descuento aplicable
 * @param {number} cantidadJuegos - Cantidad de juegos en el carrito
 * @returns {number} Porcentaje de descuento (0.0 a 1.0)
 */
function calcularDescuento(totalJuegos) {
  console.log(`üßÆ Calculando descuento para ${totalJuegos} juegos`)

  // Cliente VIP tiene descuento especial
  if (clienteVIP) {
    console.log(`‚≠ê Aplicando descuento VIP: ${DESCUENTO_VIP * 100}%`)
    return DESCUENTO_VIP
  }

  // Descuentos por cantidad
  if (totalJuegos >= 5) {
    console.log(`üéâ Descuento por 5+ juegos: ${DESCUENTO_5_JUEGOS * 100}%`)
    return DESCUENTO_5_JUEGOS
  } else if (totalJuegos >= 3) {
    console.log(`üéÅ Descuento por 3+ juegos: ${DESCUENTO_3_JUEGOS * 100}%`)
    return DESCUENTO_3_JUEGOS
  }

  console.log("üí° Sin descuento aplicable")
  return 0
}

/**
 * Funci√≥n para procesar la compra final
 */
function procesarCompra() {
  console.log("\nüí≥ PROCESANDO COMPRA")
  console.log("=".repeat(40))

  if (carritoCompras.length === 0) {
    alert("üõí No pod√©s procesar una compra con el carrito vac√≠o, loco.\n¬°Agreg√° algunos juegos primero!")
    return
  }

  // Calcular totales
  let subtotal = 0
  let totalJuegos = 0
  for (let i = 0; i < carritoCompras.length; i++) {
    subtotal += carritoCompras[i].subtotal
    totalJuegos += carritoCompras[i].cantidad
  }

  const descuento = calcularDescuento(totalJuegos)
  const montoDescuento = subtotal * descuento
  const totalConDescuento = subtotal - montoDescuento
  const impuestos = totalConDescuento * IVA
  const totalFinal = totalConDescuento + impuestos

  // PASO 1: Mostrar resumen y confirmar
  let resumenCompra = "üßæ RESUMEN DE TU COMPRA\n\n"
  resumenCompra += `üì¶ Productos (${totalJuegos} juegos):\n`

  for (let i = 0; i < carritoCompras.length; i++) {
    const juego = carritoCompras[i]
    resumenCompra += `‚Ä¢ ${juego.nombre} x${juego.cantidad} = $${juego.subtotal.toFixed(2)}\n`
  }

  resumenCompra += `\nüí∞ TOTALES:\n`
  resumenCompra += `Subtotal: $${subtotal.toFixed(2)}\n`

  if (descuento > 0) {
    resumenCompra += `Descuento: -$${montoDescuento.toFixed(2)}\n`
  }

  resumenCompra += `IVA: +$${impuestos.toFixed(2)}\n`
  resumenCompra += `TOTAL A PAGAR: $${totalFinal.toFixed(2)}\n\n`
  resumenCompra += `¬øSeguimos con la compra?`

  const continuarCompra = confirm(resumenCompra)

  if (!continuarCompra) {
    alert("‚ùå Compra cancelada. Tu carrito queda como est√°.")
    console.log("‚ùå Compra cancelada por el usuario")
    return
  }

  // PASO 2: Solicitar datos de env√≠o
  const datosEnvio = solicitarDatosEnvio()
  if (!datosEnvio) {
    alert("‚ùå Compra cancelada. Necesitamos los datos de env√≠o.")
    return
  }

  // PASO 3: Seleccionar m√©todo de pago
  const metodoPago = seleccionarMetodoPago()
  if (!metodoPago) {
    alert("‚ùå Compra cancelada. Necesitamos que elijas c√≥mo pag√°s.")
    return
  }

  // PASO 4: Procesar pago
  const pagoExitoso = procesarPago(metodoPago, totalFinal)
  if (!pagoExitoso) {
    alert("‚ùå Hubo un problema con el pago, che. Prob√° de nuevo.")
    return
  }

  // PASO 5: Confirmar compra exitosa
  const numeroOrden = Math.floor(Math.random() * 1000000)
  const fechaEntrega = new Date()
  fechaEntrega.setDate(fechaEntrega.getDate() + 3) // 3 d√≠as para entrega

  const confirmacionFinal =
    `‚úÖ ¬°COMPRA EXITOSA, CRACK!\n\n` +
    `üéâ ¬°Gracias por tu compra, che!\n\n` +
    `üìã N√∫mero de orden: #${numeroOrden}\n` +
    `üí∞ Total que pagaste: $${totalFinal.toFixed(2)}\n` +
    `üí≥ Forma de pago: ${metodoPago.tipo}\n` +
    `üìç Lo mandamos a: ${datosEnvio.direccion}, ${datosEnvio.ciudad}\n` +
    `üìÖ Te llega el: ${fechaEntrega.toLocaleDateString()}\n\n` +
    `üìß Te va a llegar un mail de confirmaci√≥n a: ${datosEnvio.email}\n\n` +
    `üéÆ ¬°Que los disfrutes, loco!`

  alert(confirmacionFinal)

  console.log(`‚úÖ Compra procesada exitosamente`)
  console.log(`üìã Orden #${numeroOrden}`)
  console.log(`üí∞ Total: $${totalFinal.toFixed(2)}`)
  console.log(`üìç Env√≠o: ${datosEnvio.direccion}, ${datosEnvio.ciudad}`)

  // Limpiar carrito
  carritoCompras = []
  console.log("üßπ Carrito limpiado")
}

/**
 * Funci√≥n para confirmar la salida del simulador
 * @returns {boolean} false si quiere salir, true si quiere continuar
 */
function confirmarSalida() {
  const confirmar = confirm("üö™ ¬øSeguro que te quer√©s ir?\n\nSe va a borrar todo lo que ten√©s en el carrito.")

  if (confirmar) {
    alert("üëã ¬°Gracias por venir a nuestro local!\nüéÆ ¬°Volv√© pronto por m√°s juegos copados!")
    console.log("üëã Usuario sali√≥ del simulador")
    return false // Salir del bucle
  }

  return true // Continuar en el simulador
}

// ==================== FUNCIONES DE UTILIDAD ====================

/**
 * Funci√≥n para mostrar estad√≠sticas del simulador (para debugging)
 */
function mostrarEstadisticas() {
  console.log("\nüìä ESTAD√çSTICAS DEL SIMULADOR")
  console.log("=".repeat(40))
  console.log(`üõí Juegos en carrito: ${carritoCompras.length}`)
  console.log(`üë§ Cliente VIP: ${clienteVIP ? "S√≠" : "No"}`)
  console.log(`üì¶ Total juegos en cat√°logo: ${catalogoJuegos.length}`)

  // Calcular stock total
  let stockTotal = 0
  for (let i = 0; i < catalogoJuegos.length; i++) {
    stockTotal += catalogoJuegos[i].stock
  }
  console.log(`üìä Stock total disponible: ${stockTotal} unidades`)
}

// ==================== INICIALIZACI√ìN ====================

// Mensaje de bienvenida en consola al cargar la p√°gina
console.log("üéÆ Simulador de Tienda de Videojuegos cargado correctamente")
console.log("üí° Haz clic en 'Iniciar Simulador' para comenzar")
console.log("üîß Escribe mostrarEstadisticas() en la consola para ver estad√≠sticas")

// Hacer la funci√≥n de estad√≠sticas disponible globalmente
window.mostrarEstadisticas = mostrarEstadisticas

/**
 * Funci√≥n para solicitar datos de env√≠o
 * @returns {Object|null} Datos de env√≠o o null si se cancela
 */
function solicitarDatosEnvio() {
  console.log("üìç Solicitando datos de env√≠o...")

  const nombre = prompt("üë§ Nombre completo para el env√≠o:")
  if (!nombre || nombre.trim() === "") return null

  const email = prompt("üìß Mail para las confirmaciones:")
  if (!email || email.trim() === "") return null

  const telefono = prompt("üì± Tel√©fono para contactarte:")
  if (!telefono || telefono.trim() === "") return null

  const direccion = prompt("üè† Direcci√≥n completa:")
  if (!direccion || direccion.trim() === "") return null

  const ciudad = prompt("üèôÔ∏è Ciudad:")
  if (!ciudad || ciudad.trim() === "") return null

  const codigoPostal = prompt("üìÆ C√≥digo postal:")
  if (!codigoPostal || codigoPostal.trim() === "") return null

  console.log("‚úÖ Datos de env√≠o recopilados")

  return {
    nombre: nombre.trim(),
    email: email.trim(),
    telefono: telefono.trim(),
    direccion: direccion.trim(),
    ciudad: ciudad.trim(),
    codigoPostal: codigoPostal.trim(),
  }
}

/**
 * Funci√≥n para seleccionar m√©todo de pago
 * @returns {Object|null} M√©todo de pago seleccionado o null si se cancela
 */
function seleccionarMetodoPago() {
  console.log("üí≥ Seleccionando m√©todo de pago...")

  const metodo = prompt(
    "üí≥ ELEG√ç C√ìMO QUER√âS PAGAR:\n\n" +
      "1Ô∏è‚É£ Tarjeta de Cr√©dito\n" +
      "2Ô∏è‚É£ Tarjeta de D√©bito\n" +
      "3Ô∏è‚É£ PayPal\n" +
      "4Ô∏è‚É£ Transferencia Bancaria\n" +
      "5Ô∏è‚É£ Efectivo (Pag√°s cuando te llega)\n\n" +
      "Metele el n√∫mero de tu opci√≥n:",
  )

  if (!metodo) return null

  let metodoPago = {}

  switch (metodo) {
    case "1":
      metodoPago = { tipo: "Tarjeta de Cr√©dito", icono: "üí≥" }
      break
    case "2":
      metodoPago = { tipo: "Tarjeta de D√©bito", icono: "üí≥" }
      break
    case "3":
      metodoPago = { tipo: "PayPal", icono: "üÖøÔ∏è" }
      break
    case "4":
      metodoPago = { tipo: "Transferencia Bancaria", icono: "üè¶" }
      break
    case "5":
      metodoPago = { tipo: "Efectivo (Contra entrega)", icono: "üíµ" }
      break
    default:
      alert("‚ùå Esa forma de pago no la tenemos, che.")
      return null
  }

  // Si es tarjeta, solicitar datos adicionales
  if (metodo === "1" || metodo === "2") {
    const numeroTarjeta = prompt("üí≥ √öltimos 4 n√∫meros de la tarjeta (es solo simulaci√≥n):")
    if (!numeroTarjeta) return null
    metodoPago.ultimosDigitos = numeroTarjeta
  }

  console.log(`‚úÖ M√©todo de pago seleccionado: ${metodoPago.tipo}`)
  return metodoPago
}

/**
 * Funci√≥n para simular el procesamiento del pago
 * @param {Object} metodoPago - M√©todo de pago seleccionado
 * @param {number} total - Total a pagar
 * @returns {boolean} true si el pago fue exitoso
 */
function procesarPago(metodoPago, total) {
  console.log(`üí≥ Procesando pago de $${total.toFixed(2)} con ${metodoPago.tipo}...`)

  // Simular tiempo de procesamiento
  alert(
    `‚è≥ Procesando el pago...\n\n${metodoPago.icono} ${metodoPago.tipo}\nüí∞ $${total.toFixed(2)}\n\nEsper√° un toque...`,
  )

  // Simular √©xito/fallo del pago (95% de √©xito)
  const pagoExitoso = Math.random() > 0.05

  if (pagoExitoso) {
    console.log("‚úÖ Pago procesado exitosamente")
    return true
  } else {
    console.log("‚ùå Error en el procesamiento del pago")
    return false
  }
}